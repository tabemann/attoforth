# Primitive IO

This is available built into attoforth. The following words are in the `IO-WORDLIST` wordlist.

`IO-ACTION-DESTROY` ( action -- )

Destroy an IO action. If an IO action is currently in use by the IO manager, destruction is deferred until the IO manager is complete in using it.

`IO-ACTION-GET-STATE` ( action -- state )

Create an IO state from an IO action, encapsulating its state at the present. Note that IO states must be destroyed with `IO-STATE-DESTROY` or otherwise they will leak memory.

`IO-STATE-DESTROY` ( state -- )

Destroy an IO state.

`IO-STATE-IS-DONE` ( state -- done )

Get whether an IO state indicates that the IO action it was created from was complete at that time.

`IO-STATE-IS-CLOSED` ( state -- closed )

Get whether an IO state indicates that the IO action it was created from corresponded to a closed file descriptor at that time.

`IO-STATE-HAS-HANGUP` ( state -- hangup )

Get whether an IO state indicates that the IO action it was created from corresponded to a hung-up file descriptor at that time.

`IO-STATE-HAS-ERROR` ( state -- error )

Get whether an IO state indicates that the IO action it was created from corresponded to a file descriptor with an error at that time.

`IO-STATE-GET-BUFFER` ( state -- addr )

Get the address for the buffer for an IO action as captured by an IO state.

`IO-STATE-GET-INDEX` ( state -- index )

Get the current index into the buffer for an IO action as captured by an IO state.

`IO-STATE-GET-COUNT` ( state -- count )

Get the maximum byte count for the buffer for an IO action as captured by an IO state.

`IO-STATE-GET-OFFSET` ( state -- offset )

Get the file offset as generated by `IO-TELL` for an IO action as captured by an IO state.

`IO-OPEN` ( c-addr count flags mode -- fd error )

Open a file at a given path with the specified flags and mode, returning a file descriptor (or a dummy value in the case of an error) and an error code, 0 in the case of sucess.

`IO-PIPE` ( -- in-fd out-fd error )

Return a pair of input and output pipes, or dummy values in the case of an error, and an error code, 0 in the case of success.

`IO-DELETE` ( c-addr count -- error )

Delete a file at a given path, returning an error code, 0 in the case of success.

`IO-DELETE-DIR` ( c-addr count -- error )

Delete an empty directory at a given path, returning an error code, 0 in the case of success.

`IO-RENAME` ( c-addr-old count-old c-addr-new count-new -- error )

Rename a file or directory from an old path to a new path, returning an error code, 0 in the case of success.

`IO-GET-MONOTONIC-TIME` ( -- secs nsecs )

Get monotonic time for the current process in seconds and nanoseconds.

`IO-SLEEP` ( secs nsecs -- )

Put the current task to sleep until the monotonic time specified in seconds and nanoseconds; note that the current task will not sleep a shorter time than this but may sleep a longer time.

`IO-TELL` ( fd -- action )

Return an IO action capturing the current offset within the file specified by the given file descriptor; the results are undefined if the file descriptor is not seekable.

`IO-CLOSE-BLOCK` ( fd -- action )

Close a given file descriptor and return a corresponding IO action, blocking the current task until closure is complete.

`IO-CLOSE-ASYNC` ( fd -- action )

Close a given file descriptor and return a corresponding IO action, without blocking.

`IO-SEEK-BLOCK` ( offset whence fd -- action )

Seek a given file descriptor to the specified whence and offset and return a corresponding IO action, blocking the current task until seeking is complete.

`IO-SEEK-ASYNC` ( offset whence fd -- action )

Seek a given file descriptor to the specified whence and offset and return a corresponding IO action, without blocking.

`IO-READ-BLOCK` ( c-addr count fd -- action )

Read up to a given number of bytes into a buffer from a file descriptor and return a corresponding IO action, blocking the current task until reading is complete or no more data can be read.

`IO-READ-ASYNC` ( c-addr count fd -- action )

Read up to a given number of bytes into a buffer from a file descriptor and return a corresponding IO action, without blocking.

`IO-WRITE-BLOCK` ( c-addr count fd -- action )

Write up to a given number of bytes from a buffer to a file descriptor and return a corresponding IO action, blocking the current task until writing is complete or no more data can be written.

`IO-WRITE-ASYNC` ( c-addr count fd -- action )

Write up to a given number of bytes from a buffer to a file descriptor and return a corresponding IO action, without blocking.

`IO-READ-NONBLOCK` ( c-addr count1 fd -- count2 again error )

Read up to a given number of bytes into a buffer from a file descriptor without blocking or reading asynchronously and return either the number of bytes read, 0 if the file descriptor has closed, or -1 if there is either an error or no more bytes are available without the file descriptor having closed, along with a flag indicating that no bytes were read but more writes may be potentially read, and an error code, 0 in the case of no error.

`IO-WRITE-NONBLOCK` ( c-addr count1 fd -- count2 again error )

Write up to a given number of bytes from a buffer to a file descriptor without blocking or reading asynchronously and return either the number of bytes written, 0 if no bytes were written, or -1 if there is either an error or no more bytes could be written without the file descriptor having closed, along with a flag indicating that no bytes were written but more writes may be potentially written (e.g. writing was interrupted), and an error code, 0 in the case of no error.

`IO-STDIN` ( -- fd )

Get the file descriptor for standard input.

`IO-STDOUT` ( -- fd )

Get the file descriptor for standard output.

`IO-STDERR` ( -- fd )

Get the file descriptor for standard error.

`IO-RDONLY` ( -- flag )

Get the flag for read-only access.

`IO-WRONLY` ( -- flag )

Get the flag for write-only access.

`IO-RDWR` ( -- flag )

Get the flag for read/write access.

`IO-APPEND` ( -- flag )

Get the flag for appending access.

`IO-TRUNC` ( -- flag )

Get the flag for truncating access.

`IO-CREAT` ( -- flag )

Get the flag for creating access.

`IO-EXCL` ( -- flag )

Get the flag for, in conjunction with `IO-CREAT`, ensuring that a file is created, i.e. opening will fail if the file already exists. Note that when these two flags are used, symbolic links are not followed.

`IO-IRWXU` ( -- mode )

Get the mode for user read-write-execute permissions.

`IO-IRUSR` ( -- mode )

Get the mode for user read permissions.

`IO-IWUSR` ( -- mode )

Get the mode for user write permissions.

`IO-IXUSR` ( -- mode )

Get the mode for user execute permissions.

`IO-IRWXG` ( -- mode )

Get the mode for group read-write-execute permissions.

`IO-IRGRP` ( -- mode )

Get the mode for group read permissions.

`IO-IWGRP` ( -- mode )

Get the mode for group write permissions.

`IO-IXGRP` ( -- mode )

Get the mode for group execute permissions.

`IO-IRWXO` ( -- mode )

Get the mode for other read-write-execute permissions.

`IO-IROTH` ( -- mode )

Get the mode for other read permissions.

`IO-IWOTH` ( -- mode )

Get the mode for other write permissions.

`IO-IXOTH` ( -- mode )

Get the mode for other execute permissions.

`IO-ISUID` ( -- mode )

Get the mode for setuid permissions.

`IO-ISGID` ( -- mode )

Get the mode for setgid permissions.

`IO-ISVTX` ( -- mode )

Get the mode for sticky bit permissions.

`IO-SEEK-SET` ( -- whence )

Get the whence for setting the current offset to a given offset from the start of a file when seeking.

`IO-SEEK-CUR` ( -- whence )

Get the whence for setting the current offset to a given offset from the current offset when seeking.

`IO-SEEK-END` ( -- whence )

Get the whence for setting the current offset to a given offset from the end of a file when seeking.
