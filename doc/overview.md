# Attoforth Overview

Attoforth is a portable indirect-threaded preemptive-multitasking Forth implementation for POSIX systems with floating-point and double cell support; currently it is for 64-bit systems but can easily be ported to support 32-bit systems.

Attoforth uses round-robin preemptive multitasking, with each task having a default number of cycles (i.e. words executed) until it gives up control of the processor, combined with a varying number of extra cycles which it may use on top of that, which it gains when it loses control of the processor due to waiting, with any leftover cycles allocated to it being saved for the next time the task executes. Note that there is a maximum number of cycles that a task may have per execution, from both the default number of cycles and the number of saved extra cycles, and furthermore a maximum number of saved extra cycles, after which any beyond that are discarded. All attoforth tasks execute in a single OS thread and do not use any OS functionality to carry out task switching. All attoforth tasks have their own stacks, wordlist orders, data spaces (except for tasks created without them), input stacks, output stacks, error stacks, and task-local storage.

Attoforth supports both blocking IO and asynchronous IO, along with immediate/nonblocking IO. Blocking IO does not block attoforth as a whole but only blocks the individual task that initiated the blocking IO. Both blocking IO and asynchronous IO returns data structures known as IO actions which allow tasks to monitor the state of IO; IO state is specifically monitored through the creation of data structures from IO actions called IO states that allow the exact state of an IO action to be seen at a moment in time without having to expose IO locks and condition variables to the user. The implementation of blocking and asynchronous IO is in the form of an OS thread that manages IO centered around `poll()` calls and uses locks and condition variables to manage communication with the main attoforth thread.

Attoforth supports both double-precision floating point and double cell numerics. Double-precision floating point involves a separate floating point stack for each task, and support for loading and storing both double-precision and single-precision numbers is present. Basic double-precision floating point support is built into attoforth. There also exists a number of math routines in `src/forth/math.fs` that calculate math functions such as `FSIN`, `FSQRT`, `FLN`, and `FEXP` for double-precision floating point numbers. Double cell numeric support supports the same functions as are supported for normal single cell numerics, with full 128-bit support on 64-bit systems (and when implemented, 64-bit support on 32-bit systems).
